<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Using the Software Development Kit</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<link href="Style.css" type="text/css" rel="stylesheet" title="Style" />
	</head>

	<body>
		<h1 align="center">Using the Software Development Kit</h1>
		
		<h2 id="ID_Introduction">Introduction</h2>
		<p>
			Let's start with some generic rules about Lemon programs :
		</p>
		<ul>
			<li>Lemon programs must be written in C language and are generated by the free tools GCC and binutils.</li>
			<li>The API you can use in your programs is the one provided by the <b>Libraries</b> (see the Libraries documentation in <b>Documentation/Documentation_Libraries/html/index.html</b> for more details). The Libraries provide a set of Lemon-specific functions, no libc-like functions are available.</li>
			<li>The only mandatory header file (<i>.h</i>) you must include in your programs is <i>&lt;System.h&gt;</i>. All features this header brings are described in the Libraries documentation.</li>
			<li>Remember, Lemon is NOT an UNIX system, it's much more embedded system oriented. Thus, a lot of UNIX paradigms are not present :
				<ul>
					<li>Everything is NOT a file. If you want to access to the serial port, use the serial port API.</li>
					<li>There are neither multiprocessing nor threads. Only one program can run at a time, but it gets all the computer power.</li>
					<li>The file system is really simple : only one root directory containing all files.</li>
					<li>Files can be opened in reading mode OR in writing mode, but not the two modes in the same time.</li>
					<li>If a program hangs, hit the <i>F12</i> key to instantly go to the system shell (as Ctrl + C in other systems, but the F12 key can't be disabled).</li>
				</ul>
			</li>
		</ul>
		<p>
			The SDK directory contains the following elements :
		</p>
		<ul>
			<li><b>Applications</b> directory : contain the source code and the binaries of all Lemon applications.</li>
			<li><b>Documentation</b> directory : provide a Libraries documentation and this manual.</li>
			<li><b>Libraries</b> directory : gather all the needed header files and the static library allowing to link Lemon programs.</li>
			<li><b>Lemon_Installer_CD_Image.iso</b> file : the system installer CDROM ISO image.</li>
		</ul>
		<p>
			The Applications directory contains the following items :
		</p>
		<ul>
			<li>The <b>Binaries</b> directory is the location of all application binaries. These files use a <i>.lemon</i> extension to indicate they are executable programs (the system does not care about file extensions, it checks the file header to determine if it is executable or not).</li>
			<li>All the object files are stored in the <b>Objects</b> directory, where each application has its own directory to avoid name conflicts.</li>
			<li>The source files are located in the <b>Sources</b> directory, using a directory-per-application scheme as for Objects directory.</li>
			<li>Some needed tools, like the program allowing to send a file to the system via the serial port or the Lemon applications linker script are located in the <b>Tools</b> directory.</li>
			<li>Finally, the main <b>Makefile</b> handling all the programs.</li>
		</ul>

		<h2 id="ID_Compiling_Program">Compiling a program</h2>
		<p>
			Lemon programs are developed and compiled on a development PC running Linux. Thus, programs are cross-compiled to generate <i>.lemon</i> Lemon executable files.<br />
			This process is managed by a simple build system.
		</p>
		<p>
			The build system is designed to ease the programmer's life when developing a program.<br />
			Indeed, the programmer must use only rules from the top Makefile (the one located in the Applications directory) to manage the compilation and downloading of a program.<br />
			The top Makefile provides almost 3 Makefile rules for each program. Let's take an example program called <b>example</b> and describe the rules related to it :
		</p>
		<ul>
			<li>make <b>example</b> : compile the program. All the object files will be stored in the Applications/Objects/Example directory, and all the generated binaries will be put in the Applications/Binaries directory.</li>
			<li>make <b>example_clean</b> : clean all program object files and binaries.</li>
			<li>make <b>example_download</b> : transfer the program binaries on a running Lemon system by using the serial port.</li>
		</ul>
		<p>
			For instance, if you want to compile the <b>Rain</b> program, go to the <b>Applications</b> directory and type <b>make_rain</b>.
		</p>
		<p>
			To compile all the Lemon programs, go to the <b>Applications</b> directory and type <b>make</b>.
		</p>

		<h2 id="ID_Transferring_Program">Transferring a program</h2>
		<p>
			The following steps show how to transfer the <b>example</b> program to Lemon :
		</p>
		<ol>
			<li>Start the Lemon virtual machine (it must be started first in order to create the communication pipe).</li>
			<li>On the development computer, go to the Applications directory and type <b>make example_download</b> to launch the server.</li>
			<li>On the Lemon machine, type <b>download</b> and hit <b>Enter</b>. The program will start downloading.</li>
			<li>When the program has been successfully downloaded, the system asks you to save or not the downloaded file to the filesystem. Say <b>yes</b> and give a name to the file.</li>
		</ol>
		<p>
			You have successfully transfered your <b>example</b> program !
		</p>
		<p>
			It is possible to send any type of files to Lemon through the serial port using the Serial_Port_Server program located in the Applications/Tools directory.<br />
			In the following commands, <b>file_to_send</b> is the path to the file to send and <b>serial_port_file</b> is the device file of the serial port to use, like ttyS0 or ttyUSB0.
		</p>
		<ul>
			<li>To send a file to the virtual machine (through the pipe), use <i>Serial_Port_Server /tmp/Lemon_Serial_Port_Pipe <b>file_to_send</b> file_name_on_lemon</i></li>
			<li>To send a file to a real PC running Lemon (through a real serial port), use <i>Serial_Port_Server /dev/<b>serial_port_file</b> <b>file_to_send</b> file_name_on_lemon</i></li>
		</ul>
		<p>
			The <i>file_name_on_lemon</i> parameter is how the file will be named on the Lemon filesystem. Remember that UTF-8 is not supported by Lemon.
		</p>
		
		<h2 id="ID_Creating_Program">Creating a new program</h2>
		<p>
			Here is the source code of the well-known Hello World program.<br />
			You must first create the new application required directories.
		</p>
		<ul>
			<li>Create a new directory named as the program in the <b>Applications/Sources</b> directory. It will store the source files.</li>
			<li>Create a second directory named as the program too in the <b>Applications/Objects</b> directory. This directory will store the object files.</li>
		</ul>
		<p>
			Now, you can integrate your application to the build system.<br />
			To integrate your application to the Lemon build system, edit the <b>Applications/Makefile</b> file.
		</p>
		<ul>
			<li>
				Copy an existing application set of rules and modify the <b><i>application_name</i></b> with the name of your application. The rules are :
				<ul>
					<li><b><i>application_name</i></b> : this rule is invoked to compile the application.</li>
					<li><b><i>application_name</i>_clean</b> : this rule is invoked to remove all files generated by compiling the application. Those files are located in the <b>Applications/Objects/application_name</b> directory. The application executable files, located in the <b>Applications/Binaries</b> directory, are also removed.</li>
					<li><b><i>application_name</i>_download</b> : this rules allows to download the executable file to the Lemon system.</li>
				</ul>
			</li>
			<li>Add the <b><i>application_name</i></b> rule name as a dependency to the <b>all:</b> rule.</li>
			<li>Add the <b><i>application_name</i>_clean</b> rule name as a dependency to the <b>clean:</b> rule.</li>
		</ul>
		<p>
			The build system integration is almost done, the only remaining thing is to add a Makefile to your own application.
		</p>
		<ul>
			<li>Copy an existing Makefile from another application to your application source directory and adapt it to fit your needs. Some applications use a makefile tailored for a single source file while other applications use a multi-source files Makefile. Choose the best Makefile for your own application.</li>
		</ul>
		<p>
			<br />
			It's now time to create the source code of the Hello World program. See the next paragraph for a fully documented example.
		</p>

		<h2 id="ID_Source_Code_Exemple">Source code example</h2>
		<p>
			The Lemon entry point is the classical <b>main()</b> function with exactly the same parameters than standard C.<br />
			The only difference with C's main() is that the function return value is ignored by Lemon. You can return whatever value you want.
		</p>
		<p>
			There is no standard C library in Lemon, you have to use the provided Libraries functions. They are documented in the <b>Documentation/Documentation_Libraries</b> directory. The <b>Libraries.h</b> header file gathers all the needed includes and is the only one to include when using the Libraries.
		</p>
		<p>
			Here is the source code of the Hello World program :
		</p>
		<p>
			<code>
				#include &lt;Libraries.h&gt;<br />
				<br />
				int main(void)<br />
				{<br />
					&nbsp;&nbsp;&nbsp;&nbsp;LibrariesScreenSetFontColor(SCREEN_COLOR_GREEN);<br />
					&nbsp;&nbsp;&nbsp;&nbsp;LibrariesScreenWriteString("Hello ");<br />
					&nbsp;&nbsp;&nbsp;&nbsp;LibrariesScreenSetFontColor(SCREEN_COLOR_RED);<br />
					&nbsp;&nbsp;&nbsp;&nbsp;LibrariesScreenWriteString("world !\n");<br />
					&nbsp;&nbsp;&nbsp;&nbsp;return 0;<br />
				}
			</code>
		</p>
		
		<p>
			<a href="../Manual.html">Return to main page</a>
		</p>
	</body>
</html>
