<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Using the Software Development Kit</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	</head>

	<body>
		<h1 align="center">Using the Software Development Kit</h1>
		
		<h2 id="ID_Introduction">1. Introduction</h2>
		<p>
			Let's start with some generic rules about Lemon programs :
		</p>
		<ul>
			<li>Lemon programs must be written in C language and are generated by the free tools GCC and binutils.</li>
			<li>The API you can use in your programs is the one provided by the <b>Libraries</b> (see the Libraries documentation in <b>Documentation/Documentation_Libraries/html/index.html</b> for more details). The Libraries provide a set of standard libc functions and Lemon system specific functions.</li>
			<li>The header files (<i>.h</i>) you can include in your programs are the same than in a Linux system and the one availables are described in the Libraries documentation. You must include the <i>System.h</i> header in your application if you want to use Lemon-specific features (which are also described in the Libraries documentation).</li>
			<li>Remember, Lemon is NOT an UNIX system, it's much more embedded system oriented. Thus, a lot of UNIX paradigms are not present :
				<ul>
					<li>Everything is NOT a file. If you want to access to the serial port, use the serial port API.</li>
					<li>There are neither multiprocessing nor threads. Only one program can run at a time, but it gets all the computer power.</li>
					<li>The file system is really simple : only one root directory containing all files.</li>
					<li>Files can be opened in reading mode OR in writing mode, but not the two modes in the same time.</li>
					<li>If a program hangs, hit the <i>F12</i> key to instantly go to the system shell (as Ctrl + C in other systems, but the F12 key can't be disabled).</li>
				</ul>
			</li>
		</ul>
		<p>
			The SDK directory contains the following elements :
		</p>
		<ul>
			<li><b>Applications</b> directory : contain the source code and the binaries of all Lemon applications.</li>
			<li><b>Documentation</b> directory : provide a Libraries documentation and this manual.</li>
			<li><b>Libraries</b> directory : gather all the needed header files and the static library allowing to link Lemon programs.</li>
			<li><b>Lemon_Installer_CD_Image.iso</b> file : the system installer CDROM ISO image.</li>
		</ul>
		<p>
			The Applications directory contains the following items :
		</p>
		<ul>
			<li>The <b>Binaries</b> directory is the location of all application binaries. These files use a <i>.32b</i> extension to indicate they are 32-bit executables (to differenciate them with very old 16-bit real-mode <i>.16b</i> executables).</li>
			<li>All the object files are stored in the <b>Objects</b> directory, where each application has its own directory to avoid name conflicts.</li>
			<li>The source files are located in the <b>Sources</b> directory, using a directory-per-application scheme as for Objects directory.</li>
			<li>Some needed tools, like the program allowing to send a file to the system via the serial port or the Lemon applications liker script are located in the <b>Tools</b> directory.</li>
			<li>Finally, the main <b>Makefile</b> handling all the programs.</li>
		</ul>

		<hr />
		<h2 id="ID_Compiling_Program">2. Compiling a program</h2>
		<p>
			Lemon programs are developed and compiled on a development PC running Linux. Thus, programs are cross-compiled to generate .32b Lemon executable files.<br />
			This process is managed by a simple build system.
		</p>
		<p>
			The build system is designed to ease the programmer's life when developing a program.<br />
			Indeed, the programmer must use only rules from the top Makefile (the one located in the Applications directory) to manage the compilation and downloading of a program.<br />
			The top Makefile provides almost 3 Makefile rules for each program. Let's take an example program called <b>example</b> and describe the rules related to it :
		</p>
		<ul>
			<li>make <b>example</b> : compile the program. All the object files will be stored in the Applications/Objects/Example directory, and all the generated binaries will be put in the Applications/Binaries directory.</li>
			<li>make <b>example_clean</b> : clean all program object files and binaries.</li>
			<li>make <b>example_download</b> : transfer the program binaries on a running Lemon system by using the serial port.</li>
		</ul>
		<p>
			For instance, if you want to compile the <b>Rain</b> program, go to the <b>Applications</b> directory and type <b>make_rain</b>.
		</p>
		<p>
			To compile all the Lemon programs, go to the <b>Applications</b> directory and type <b>make</b>.
		</p>

		<hr />
		<h2 id="ID_Transfering_Program">3. Transfering a program</h2>
		<p>
			The steps show how to transfer the <b>example</b> program to Lemon :
		</p>
		<ol>
			<li>Start the Lemon virtual machine (it must be started in first in order to create the communication pipe).</li>
			<li>On the development computer, go to the Applications directory and type <b>make example_download</b> to launch the server.</li>
			<li>On the Lemon machine, type <b>download</b> and hit <b>Enter</b>. The program will start downloading.</li>
			<li>When the program has been successfully downloaded, the system asks you to save or not the downloaded file to the filesystem. Say <b>yes</b> and give a name to the file.</li>
		</ol>
		<p>
			You have successfully transfered your <b>example</b> program !
		</p>
		<p>
			It is possible to send any type of files to Lemon through the serial port using the Serial_Port_Server program located in the Applications/Tools directory.<br />
			In the following commands, <b>file_to_send</b> is the path to the file to send and <b>serial_port_file</b> is the device file of the serial port to use, like ttyS0 or ttyUSB0.
		</p>
		<ul>
			<li>To send a file to the virtual machine (through the pipe), use <i>Serial_Port_Server /tmp/Lemon_Serial_Port_Pipe 1 <b>file_to_send</b></i></li>
			<li>To send a file to a real PC running Lemon (through a real serial port), use <i>Serial_Port_Server /dev/<b>serial_port_file</b> 0 <b>file_to_send</b></i></li>
		</ul>
		
		<hr />
		<h2 id="ID_Creating_Program">4. Creating a new program</h2>
		<p>
			TODO
		</p>



		
	<!--	<hr />
		<h2>4. Exemple complet</h2>
		<p>
			Voici le code source du classique Hello World qui utilise quelques fonctions sp&eacute;cifiques &agrave; EsilOS. Il faut donc inclure le fichier <b>&lt;ESILOS.h&gt;</b>.
		</p>

		<h3>Code source</h3>
		<p>
			Cr&eacute;er le fichier <b>Exemple.c</b> dans le dossier <b>Applications</b> et y taper le code suivant :
		</p>
		<p>
			<code>
				#include &lt;stdio.h&gt;<br />
				#include &lt;ESILOS.h&gt;<br />
				<br />
				int main(void)<br />
				{<br />
					&nbsp;&nbsp;&nbsp;&nbsp;ConsoleSetFontColor(CONSOLE_COLOR_GREEN);<br />
					&nbsp;&nbsp;&nbsp;&nbsp;printf("Hello ");<br />
					&nbsp;&nbsp;&nbsp;&nbsp;ConsoleSetFontColor(CONSOLE_COLOR_RED);<br />
					&nbsp;&nbsp;&nbsp;&nbsp;printf(" world !");<br />
					&nbsp;&nbsp;&nbsp;&nbsp;return 0;<br />
				}
			</code>
		</p>

		<h3>Compilation</h3>
		<p>
			Ouvrir une console, se rendre dans le dossier <b>Applications</b> et taper : <b>./comp Exemple</b>
			Si la compilation s'est bien pass&eacute;e, le fichier <b>Exemple.32b</b> a d&ucirc; &ecirc;tre cr&eacute;&eacute;.
		</p>

		<h3>Transfert sur le syst&egrave;me</h3>
		<ul>
			<li>Lancer la machine virtuelle.</li>
			<li>Dans la console du syst&egrave;me h&ocirc;te pr&eacute;c&eacute;demment ouverte taper : <b>./down Exemple.32b</b>. Le serveur sur la machine h&ocirc;te attend qu'EsilOS se connecte.</li>
			<li>Dans la console d'EsilOS taper : <b>download</b>. Le t&eacute;l&eacute;chargement devrait commencer (s'il ne commence pas relancer la machine virtuelle puis le serveur).</li>
			<li>Une fois le t&eacute;l&eacute;chargement termin&eacute;, le syst&egrave;me vous propose de sauvegarder ou de lancer directement le programme.<br />
				<b>Note :</b> si vous choisissez l'option <b>Sauvegarder</b> et que le nom de fichier que vous tapez correspond &agrave; un fichier d&eacute;j&agrave; existant, ce fichier sera automatiquement &eacute;cras&eacute; par celui que vous venez de t&eacute;l&eacute;charger. Attention &agrave; la perte de donn&eacute;es !
			</li>
		</ul>-->

		<p>
			<a href="../Manual.html">Return to main page</a>
		</p>
	</body>
</html>