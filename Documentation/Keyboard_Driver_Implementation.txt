Keyboard driver implementation
------------------------------

Document author : Adrien RICCIARDI
Document version : 1.2, 16/07/2013

IBM keyboard functionning :
---------------------------

The keyboard behaviour is really simple, it tells if a key is pressed or released.
Each keystroke owns an identifying 7-bit scan code. The state of the keystroke (pressed or released), is indicated by the value of the eighth bit of the byte sent by the keyboard.
Some keys have been added after the first keyboard version, they are called "extended keys". To differenciate between normal scan codes and extended scan codes, the byte value 0xE0 is sent before an extended scan code.

Using keyboards terminology, to press a key generates a "make code" and to release a key generates a "release code" or "break code".

The following codes are read directly from the keyboard controller (the key pattern is for an AZERTY keyboard).

Normal codes :
--------------

Key					Scan code (in decimal notation, otherwise 0x is added)
Escape				1
1 &					2
2 é ~				3
3 " #				4
4 ' {				5
5 ( [				6
6 - |				7
7 è `				8
8 _ \				9
9 ç ^				10
0 à @				11
° ) ]				12
+ = }				13
Backspace			14
Tabulation			15
A					16
Z					17
E €					18
R					19
T					20
Y					21
U					22
I					23
O					24
P					25
¨ ^					26
£ $					27
Enter				28
Left ctrl			29
Q					30
S					31
D					32
F					33
G					34
H					35
J					36
K					37
L					38
M					39
% ù					40
Power 2				41
Left shift			42
µ *					43
W					44
X					45
C					46
V					47
B					48
N					49
? ,					50
; .					51
/ :					52
§ !					53
Right shift			54
Numpad *			55
Alt					56
Space				57

F1					59
F2					60
F3					61
F4					62
F5					63
F6					64
F7					65
F8					66
F9					67
F10					68
Num lock			69
Scroll lock			70
Numpad 7			71
Numpad 8			72
Numpad 9			73
Numpad -			74
Numpad 4			75
Numpad 5			76
Numpad 6			77
Numpad +			78
Numpad 1			79
Numpad 2			80
Numpad 3			81
Numpad 0			82
Numpad .			83

> <					86
F11					87
F12					88

Extended codes (starting with 0xE0) :
-------------------------------------

Key					Scan code
Numpad enter		0xE0 28
Right ctrl			0xE0 29

Numpad /			0xE0 53

Altgr				0xE0 56

Origin				0xE0 71
Arrow up			0xE0 72
Page up				0xE0 73

Arrow left			0xE0 75

Arrow right			0xE0 77

End					0xE0 79
Arrow down			0xE0 80
Page down			0xE0 81
Insert				0xE0 82
Del					0xE0 83

Windows left		0xE0 91
Windows right		0xE0 92
Mouse right click	0xE0 93

Specifications :
----------------

# Despite keyboard drivers from other systems, this one provides only one byte identifying the pressed key.
Non ASCII keys have a virtual code out of the printable character codes range, but still stored on one byte.

# When multiple "ASCII" keys are pressed, only the last pressed one is recorded.

# Stress mode generates only lowercase stressed letters, even if uppercase mode is set (use normal uppercase letters instead of stressed ones) because there is not the ASCII code corresponding to uppercase stressed letters.

# ASCII codes from 224 to 250 are reserved for virtual codes as their ASCII representations are not really useful.

# When pressing a shift key and caps lock is active, caps lock mode is disabled. This is the only way to disable caps lock.

# Stress key (¨ ^) can be used only to create stressed vowels, because the ^ symbol can be done with Alt Gr + 9 and the ¨ symbol does not exist into the ASCII code.

# Alt Gr + c = Ç

# Only 3 keys are not supported for now (pressing them can lead into an undetermined behaviour) :
Print screen
Scroll lock
Pause

# The following "special" keys are considered normal keys and return a virtual code when they are pressed :
Left ctrl
Right ctrl
Num lock (it it always enabled and can't be disabled, so the numpad always returns numbers)
Alt
Left Windows
Right Windows
Mouse right click menu
Up arrow
Down arrow
Left arrow
Right arrow
Insert
Origin
Del
End
Page up
Page down

# The following keys do not return a code when they are pressed, but modify the following pressed key values :
Left shift and Right shift enable uppercase mode when held
Caps lock enables uppercase mode when it is pressed and released. The second press / release sequence disables uppercase mode
Alt Gr enables third key symbol mode when held
¨ ^ key prints nothing alone but must be used with vowels. First, the ¨ ^ key is pressed and released. Second, a vowel key is pressed and released. It does nothing with wrong keys.

